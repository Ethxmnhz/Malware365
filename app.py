# app.py
from flask import Flask, request, jsonify
import requests
import os
from flask_cors import CORS  # Add this line
 
app = Flask(__name__)
CORS(app)
# Replace 'YOUR_VIRUSTOTAL_API_KEY' with your actual VirusTotal API key
VIRUSTOTAL_API_KEY = '655ff61776fa5397a152a7ac6a64afcd78041ba664a6cb14659ad66753c0c8f6'
VIRUSTOTAL_API_URL = 'https://www.virustotal.com/vtapi/v2/file/scan'

@app.route('/upload', methods=['POST'])
def upload_file():
    if 'file' not in request.files:
        return jsonify({'error': 'No file part'})

    file = request.files['file']

    if file.filename == '':
        return jsonify({'error': 'No selected file'})

    # Save the file temporarily
    file_path = os.path.join('uploads', file.filename)
    print("File path:", file_path) 
    file.save(file_path)

    # Scan the file with VirusTotal API
    response = scan_file_with_virustotal(file_path)

    # Delete the temporary file
    os.remove(file_path)

    return jsonify(response)

def scan_file_with_virustotal(file_path):
    files = {'file': (file_path, open(file_path, 'rb'))}
    params = {'apikey': VIRUSTOTAL_API_KEY}
    response = requests.post(VIRUSTOTAL_API_URL, files=files, params=params)

    if response.status_code == 200:
        result = response.json()
        return result
    else:
        return {'error': 'Failed to scan the file with VirusTotal'}

if __name__ == '__main__':
    app.run(debug=True)
